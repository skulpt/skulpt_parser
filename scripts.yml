scripts:
    build:
        desc: bundles the source files and copies it to dist folder
        cmd: deno run scripts/build.ts
        allow:
            - write
            - read
            - env
            - run
            - net

    bundle:
        cmd: deno bundle src/mod.ts dist/bundle.js

    gen_parser:
        - vr apply_grammar_patch
        - python -m tools.gen_parser
        - (pre-commit run prettier --files src/parser/generated_parser.ts || true)

    gen_asdl:
        cmd: python -m tools.gen_asdl

    format:
        cmd: pre-commit run --all-files

    gen_ast:
        cmd: cd run-tests && ls -1 *.py | xargs -n1 python3 tools/dump-ast.py

    apply_grammar_patch:
        - cd ../cpython/Grammar && git checkout -- python.gram
        - cd ../cpython/Grammar && git apply ../../skulpt_parser/tools/patch/grammar.patch

    gen_grammar_patch:
        cmd: cd ../cpython/Grammar && git diff -- python.gram -p > ../../skulpt_parser/tools/patch/grammar.patch

    gen_grammar_helper:
        desc: generate a temporary grammar file using some regex helpers to help build the grammar patch
        cmd:
            - cmd: deno run tools/patch/gen_grammar_helper.ts
              allow:
                  - read
                  - write
            - (pre-commit run trailing-whitespace --all-files || true)

    test:
        cmd: deno test
        allow:
            - read
            - run

    parse:
        cmd: deno run src/parse.ts
        allow:
            - read
            - run
